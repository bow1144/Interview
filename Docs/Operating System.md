## 进程

### 1. 进程的概念
进程是一个具有独立功能的**程序**在一个**数据集合**上运行的过程，是**系统进行资源分配和调度的一个独立单位**

### 2. 进程控制块PCB
系统通过PCB获取进程的基本情况和运行状态，从而控制和管理进程。**PCB是进程存在的唯一标识**  
PCB包含以下信息：
1. **进程描述信息**：进程标识符，用户标识符
2. **进程控制管理信息**：进程当前状态，进程优先级
3. **进程资源分配清单**：内存地址空间、打开文件列表、所用IO设备信息
4. **CPU相关信息**：进程切换时CPU寄存器的值存在PCB中，以便重新执行

### 3. 并行与并发
1. **并发**是**单个**处理核在短时间执行多个进程。CPU切换进程必须在PCB中记录当前状态信息，一遍切换回来时继续执行
2. **并行**是**多个**处理核同时执行多个进程

### 4. 进程的状态切换
1. 运行态：进程占用CPU
2. 就绪态：可运行，等待其它运行中的进程
3. 阻塞态：等待IO等事件发生而暂停
4. 创建状态：进程正在被创建
5. 结束状态：进程正在从系统中消失

<img width="576" alt="{98091CE5-D29A-4A6B-B5B3-33F375D4412A}" src="https://github.com/user-attachments/assets/502ad9e1-ba6b-4c05-8ba4-2f70f5d07054">

如果有大量进程阻塞，操作系统将阻塞态进程换出到**硬盘**，需要运行时再换到内存。**挂起状态**描述没有占用物理内存的进程；挂起可以分为阻塞挂起与就绪挂起  
* 阻塞挂起状态：在硬盘等待事件
* 就绪挂起状态：在硬盘等待，只要进入内存就立刻运行

<img width="576" alt="{9548C2CA-FA53-4403-A08B-0DB76335E385}" src="https://github.com/user-attachments/assets/2902b156-ab43-4dc1-b5da-08b4fea686d5">

**进程切换的特点**  
1. 只有就绪态和运行态可以互相转化（操作系统调度进程时），其它都是单向转化
2. 进程用完CPU时间片会从运行态变为就绪态
3. 阻塞态是**缺少资源**的运行态转化来的，但这个资源不包括CPU时间片
4. 外部事件发生后由阻塞态变为运行态或就绪态

### 5. 进程的上下文切换
**一个进程切换到另一个进程运行**称为进程的上下文切换。进程的上下文切换不仅包含了虚拟内存、栈、全局变量等用户资源，还包括了内核堆栈，寄存器等内核空间资源  
进程的上下文切换在以下情况发生：  
* 运行态与其它状态之间的转化
* 进程通过`sleep()`等方法自我挂起

### 6. 进程的创建
一个进程可以创建另一个进程，被称为**父进程与子进程**。OS创建进程的过程如下：  
1. 分配PCB
2. 分配资源
3. 初始化PCB
4. 将其设置为就绪态

### 7. 进程的终止
1. 操作系统根据标识符找到需要终止的进程的PCB
2. 掐断执行，让出处理器
3. 如果还有子进程，将其交给一号进程接管

### 8. 进程的阻塞
1. 操作系统找到对应的PCB
2. 从运行态拉出，转化为阻塞态，停止运行
3. 将PCB插入等待队列中，处理机让给其它资源

### 9. 进程的唤醒
1. 在阻塞队列中找到PCB
2. 从阻塞队列移出，置为就绪态
3. 将PCB插入到就绪队列中，等待调度

## 线程

### 1. 什么是线程
* 线程是操作系统能执行的最小单位，也是系统独立和分配的基本单位
* 一个进程包括多个线程，**线程是进程的一条执行流程**
* 进程间共享代码，数据等资源，但也有自己独立的栈，计数器等

### 2. 线程的特点
* **独立性**：线程是程序执行的基本单位，有独立的栈，计数器等。因此可以高效交换数据
* **共享资源**：进程中的线程共享资源，因此交流高效
* **并发性**，各个线程可并发执行

### 3. 进程与线程
> 可以将进程比作公司，线程比作员工。进程拥有自己的资源和管理；线程负责具体的任务，拥有线程的资源

进程是资源分配的单位，线程是CPU调度的单位；线程可以蜕变为进程

事实上在Linux中，创建进程，线程的底层逻辑一样，**复制地址空间是进程，共享对方空间是线程**

**3.1 资源**：
进程是**操作系统中拥有资源的基本单位**，线程只有一点能保证运行的资源，但可以访问隶属进程的资源

**3.2 调度**：
**进程切换的代价远远大于线程**，同一个进程中线程切换不会引起进程切换

**3.3 并发**：
进程，线程都可以并发执行，不同进程中的线程也可以并发执行

**3.4 独立**：
进程之间拥有强独立性，进程不可见另一进程中的线程；同一进程中的线程共享资源

**3.5 系统开销**：
线程的系统开销远远小于进程。在**创建、终止、切换、共享**资源等方面线程的开销远远小于进程。

### 4. 线程的状态：
* 执行状态：线程获得处理机
* 就绪状态：线程已具备执行条件，只需获得CPU
* 阻塞状态：线程因事件而受阻

### 5. 线程的实现

#### 5.1 用户线程 ULT（外包）
**用户级线程由用户在用户空间创建管理的**，操作系统不直到、管理这些线程，而将所有用户级线程视为一个进程。优点是创建，切换线程开销小；缺点是脱离OS管理，无法发挥多核处理器的优势

#### 5.2 内核线程 KLT （正式工，较多）
由OS管理调度，内核中有对应TCB。优点是可以利用OS给管理**并行**执行线程，线程阻塞不会辐射到整个进程；缺点是创建、切换开销较大

#### 5.3 轻量级线程 LWP （派遣）
**内核支持的用户线程**，每个LWP与内核线程一一对应，每个LWP由一个内核线程支持。在一般操作系统中不被重用

### 6. 线程共享资源
线程独立拥有id、栈、优先级等维持生命的资源

### 7. 线程的优缺点
* 优点：提高并发性，开销小，通信方便
* 缺点：不稳定，调试编写困难

### 8. 线程如何减少开销
更快的创建、终止、切换，更高的交流效率
